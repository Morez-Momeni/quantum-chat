<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ورود | {{ username }}</title>
    <link rel="stylesheet" href="/static/style.css" />
    <style>
        .login-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #0a0a1e; display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .login-box { background: rgba(255,255,255,0.1); backdrop-filter: blur(12px); padding: 3rem; border-radius: 24px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.4); }
        .login-box h2 { color: white; margin-bottom: 1rem; font-size: 2rem; }
        input { width: 100%; padding: 1rem; margin: 1rem 0; border: none; border-radius: 12px; background: rgba(255,255,255,0.2); color: white; font-size: 1.1rem; }
        input::placeholder { color: #ccc; }
        button { background: #00d4ff; color: white; border: none; padding: 1rem 2rem; border-radius: 12px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 1rem; transition: 0.3s; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        .error { color: #ff2e63; margin-top: 1rem; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <h2>خوش اومدی {{ username }}</h2>
            <p style="color:#aaa; margin-bottom:1.5rem;">رمز عبور رو وارد کن</p>
            <input type="password" id="password" placeholder="رمز عبور..." />
            <button id="login-btn">ورود به چت</button>
            <p class="error" id="error"></p>
        </div>
    </div>

    <script>
        const username = "{{ username }}";
        const loginBtn = document.getElementById("login-btn");
        const passwordInput = document.getElementById("password");
        const errorEl = document.getElementById("error");

        async function login() {
            const password = passwordInput.value.trim();
            if (!password) { errorEl.textContent = "رمز رو وارد کن!"; return; }
            errorEl.textContent = "در حال ورود...";
            loginBtn.disabled = true;
            const formData = new FormData();
            formData.append("password", password);
            try {
                const res = await fetch(`/login/${encodeURIComponent(username)}`, { method: "POST", body: formData });
                const data = await res.json();
                if (data.success) {
                    localStorage.setItem("username", username);
                    window.location.href = "/chat";
                } else {
                    errorEl.textContent = data.error || "خطا!";
                    loginBtn.disabled = false;
                }
            } catch {
                errorEl.textContent = "خطای اتصال!";
                loginBtn.disabled = false;
            }
        }

        loginBtn.addEventListener("click", login);
        passwordInput.addEventListener("keypress", e => { if (e.key === "Enter") login(); });
    </script>
</body>
</html>